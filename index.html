<!DOCTYPE html>
<html>
<head>
    <title>pixelIt Demo</title>
    <style>div { float: left; margin: 10px; border: 1px solid #333; }</style>
    <script src="pixelIt.js"></script>
</head>
<body>
    <div id="container1"></div>
    <div id="container2"></div>

    <p style="clear:both;"><button id="act">Process</button>
<script>
window.addEventListener('DOMContentLoaded', function(evt) {
    var img1 = pixelIt('container1').load('image.jpg');
    var img2 = pixelIt('container2').load('image.jpg');

    var button = document.getElementById('act');
    button.addEventListener('click', function(evt) {
        var patchImg1;

        img1.process(function(image) {
            patchImg1 = image.patch(Math.ceil(image.width / 2), Math.ceil(image.height / 2), image.width, image.height);
        });

        img2.process(function(image) {
            var i = -1;
            image.patch(0, 0, Math.ceil(image.width / 2), Math.ceil(image.height / 2), function(r, g, b, a) {
                i = i + 1;
                var sr, sg, sb, sa;
                if (patchImg1[i]) {
                    sr = patchImg1[i][0];
                    sg = patchImg1[i][1];
                    sb = patchImg1[i][2];
                    sa = patchImg1[i][3];
                }
                var gray = image.util.rgb2gray(sr, sg, sb);
                return [gray, gray, gray, a];
            });

            image.draw();
        });

    });

}, false);
</script>
</body>
</html>
